#+title: Noonker's Config

Below is my configuration for Emacs. It is a literate config that can be installed by running =org-babel-tangle= or by using the hotkey =C-c C-v C-t=.
It is broken up into several sections:
 - Bootstrap - Code that instantiates the package manager
 - Behavior - Packages & tweaks to the behavior of emacs
 - Tools - Any packages which modify the behavior of emacs
 - Programming - Packages & tweaks to programming modes
 - Text - Any packages which are used primarily for writing of text (mostly org-mode)
 - Custom Functions - Any simple functions I've added to enrich my emacs life

* Bootstrap Straight.el

This section sets up [[https://github.com/radian-software/straight.el][straight.el]] with [[https://github.com/jwiegley/use-package][use-package]] to simplify setup of emacs. These packages allow me to control how the packages are installed, when they are loaded, and which configurations should be run with them.

#+begin_src emacs-lisp :tangle ~/.emacs
(defvar bootstrap-version)

(let ((bootstrap-file
       (expand-file-name "straight/repos/straight.el/bootstrap.el" user-emacs-directory))
      (bootstrap-version 5))
  (unless (file-exists-p bootstrap-file)
    (with-current-buffer
	(url-retrieve-synchronously
	 "https://raw.githubusercontent.com/raxod502/straight.el/develop/install.el"
	 'silent 'inhibit-cookies)
      (goto-char (point-max))
      (eval-print-last-sexp)))
  (load bootstrap-file nil 'nomessage))

;; Tell use-package to use straight to install applications
(straight-use-package 'use-package)

;; ...without specifying :straight
(setq straight-use-package-by-default 't)
#+end_src

* Behavior

** Platform Check
#+begin_src emacs-lisp :tangle ~/.emacs
(defun current-platform ()
  (interactive)
  (cond
   ((string-equal "Android\n" (shell-command-to-string "uname -o")) "android")
   ((string-equal system-type "windows-nt") "windows")
   ((string-equal system-type "darwin") "mac")
   ((string-equal system-type "gnu/linux") "linux"))
  )

(defcustom im-at-work t
  "im-at-work can be used to conditionally disable code which may not be suitable for work environments. ChatGPT, copilot, etc"
  :type '(boolean))

(if (string= (system-name)
	     "blep")
    (setq im-at-work nil))

(if (string= (current-platform)
	     "mac")
      (use-package exec-path-from-shell
	:init (exec-path-from-shell-initialize)))
#+end_src

** Vertico

#+begin_src emacs-lisp :tangle ~/.emacs
;; Enable vertico

(use-package vertico
  :ensure t
  :bind (:map vertico-map
              :map minibuffer-local-map
              ("M-h" . backward-kill-word))
  :init
  (vertico-mode)
  )

;; Persist history over Emacs restarts. Vertico sorts by history position.
(use-package savehist
  :init
  (savehist-mode))

;; A few more useful configurations...
(use-package emacs
  :init
  ;; Add prompt indicator to `completing-read-multiple'.
  ;; We display [CRM<separator>], e.g., [CRM,] if the separator is a comma.
  (defun crm-indicator (args)
    (cons (format "[CRM%s] %s"
                  (replace-regexp-in-string
                   "\\`\\[.*?]\\*\\|\\[.*?]\\*\\'" ""
                   crm-separator)
                  (car args))
          (cdr args)))
  (advice-add #'completing-read-multiple :filter-args #'crm-indicator)

  ;; Do not allow the cursor in the minibuffer prompt
  (setq minibuffer-prompt-properties
        '(read-only t cursor-intangible t face minibuffer-prompt))
  (add-hook 'minibuffer-setup-hook #'cursor-intangible-mode)

  ;; Emacs 28: Hide commands in M-x which do not work in the current mode.
  ;; Vertico commands are hidden in normal buffers.
  ;; (setq read-extended-command-predicate
  ;;       #'command-completion-default-include-p)

  ;; Enable recursive minibuffers
  (setq enable-recursive-minibuffers t))

;; Optionally use the `orderless' completion style.
(use-package orderless
  :init
  ;; Configure a custom style dispatcher (see the Consult wiki)
  ;; (setq orderless-style-dispatchers '(+orderless-consult-dispatch orderless-affix-dispatch)
  ;;       orderless-component-separator #'orderless-escapable-split-on-space)
  (setq completion-styles '(orderless basic)
        completion-category-defaults nil
        completion-category-overrides '((file (styles partial-completion)))))

(use-package marginalia
  :ensure t
  :config
  (marginalia-mode))

(use-package embark
  :ensure t

  :bind
  (("C-." . embark-act)         ;; pick some comfortable binding
   ("C-;" . embark-dwim)        ;; good alternative: M-.
   ("C-h B" . embark-bindings)) ;; alternative for `describe-bindings'

  :init

  ;; Optionally replace the key help with a completing-read interface
  (setq prefix-help-command #'embark-prefix-help-command)

  ;; Show the Embark target at point via Eldoc.  You may adjust the Eldoc
  ;; strategy, if you want to see the documentation from multiple providers.
  (add-hook 'eldoc-documentation-functions #'embark-eldoc-first-target)
  ;; (setq eldoc-documentation-strategy #'eldoc-documentation-compose-eagerly)

  :config

  ;; Hide the mode line of the Embark live/completions buffers
  (add-to-list 'display-buffer-alist
               '("\\`\\*Embark Collect \\(Live\\|Completions\\)\\*"
                 nil
                 (window-parameters (mode-line-format . none)))))

(use-package consult)
(use-package embark-consult)
(use-package consult-ag)
(use-package consult-dir)
(use-package consult-org-roam)
(global-set-key (kbd "C-2") #'consult-buffer)
(global-set-key (kbd "C-3") #'yank-from-kill-ring)

(use-package corfu
  ;; Optional customizations
  ;; :custom
  ;; (corfu-cycle t)                ;; Enable cycling for `corfu-next/previous'
  ;; (corfu-quit-at-boundary nil)   ;; Never quit at completion boundary
  ;; (corfu-quit-no-match nil)      ;; Never quit, even if there is no match
  ;; (corfu-preview-current nil)    ;; Disable current candidate preview
  ;; (corfu-preselect 'prompt)      ;; Preselect the prompt
  ;; (corfu-on-exact-match nil)     ;; Configure handling of exact matches

  ;; Enable Corfu only for certain modes. See also `global-corfu-modes'.
  ;; :hook ((prog-mode . corfu-mode)
  ;;        (shell-mode . corfu-mode)
  ;;        (eshell-mode . corfu-mode))

  ;; Recommended: Enable Corfu globally.  This is recommended since Dabbrev can
  ;; be used globally (M-/).  See also the customization variable
  ;; `global-corfu-modes' to exclude certain modes.
  :init
  (global-corfu-mode))

;; A few more useful configurations...
(use-package emacs
  :custom
  ;; TAB cycle if there are only few candidates
  ;; (completion-cycle-threshold 3)

  ;; Enable indentation+completion using the TAB key.
  ;; `completion-at-point' is often bound to M-TAB.
  (tab-always-indent 'complete)

  ;; Emacs 30 and newer: Disable Ispell completion function.
  ;; Try `cape-dict' as an alternative.
  (text-mode-ispell-word-completion nil)

  ;; Hide commands in M-x which do not apply to the current mode.  Corfu
  ;; commands are hidden, since they are not used via M-x. This setting is
  ;; useful beyond Corfu.
  (read-extended-command-predicate #'command-completion-default-include-p))

#+end_src

** Theme

Leuven Theme and Comic Mono

#+begin_src emacs-lisp :tangle ~/.emacs
(defvar how-ya-feeling 'burn-my-eyes)

(cond
 ((eq how-ya-feeling 'dark-tbh)
    (use-package cyberpunk-theme)
     (load-theme 'cyberpunk t))
  ((eq how-ya-feeling 'burn-my-eyes)
   (load-theme 'leuven)
    ))

;; Better font on my home computer :)
(if im-at-work
    (set-face-attribute 'default nil :font "JetBrains Mono" :height 150)
(set-face-attribute 'default nil :font "Comic Code" :height 130))
#+end_src

** Global Config

Random global behavior configs

#+begin_src emacs-lisp :tangle ~/.emacs
(setq display-line-numbers-type 'relative) ;; Relative line numbers
(add-hook 'artist-mode-hook (lambda () (setq indent-tabs-mode nil)))
(global-display-line-numbers-mode) ;; Enable line numbers
(custom-set-variables '(linum-format 'dynamic)) ;; Automatically align line numbers
(global-hl-line-mode) ;; Highlight the current line
(tool-bar-mode -1) ;; Don't show the ugly emacs toolbar
(scroll-bar-mode -1) ;; No scroll bars
(menu-bar-mode -1) ;; No menu bar
(display-time-mode 1) ;; Show a clock in the modeline
(winner-mode 1) ;; Undo recent buffer configurations
(defalias 'yes-or-no-p 'y-or-n-p) ;; Shorten yes and no
(global-subword-mode 1) ;; Makes emacs understand CamelCase words as two words
(setq reb-re-syntax 'string) ;; Emacs re-mode uses string syntax
(setq recentf-auto-cleanup 'never) ;; disable before we start recentf!
(recentf-mode 1) ;; Remember which files I've recently used
(setq backup-directory-alist '(("." . "~/.emacs.d/backups"))) ;;; Move backups
(setq delete-old-versions -1) ;; Never delete backups
(setq version-control t) ;; Honestly... don't remember but I'm sure I want this
(setq vc-make-backup-files t) ;; Also make backup files for version controller files
(setq auto-save-file-name-transforms '((".*" "~/.emacs.d/auto-save-list/" t))) ;; Store autosaves in this folder instead of next to the file
(setq inhibit-startup-screen t) ;; Don't show the starup screen
(setq create-lockfiles nil) ;; I don't work on systems where multiple people are editing the same files with emacs.
(global-so-long-mode 1) ;; Stop trying to syntax highlight absurdly long strings
(global-set-key (kbd "C-s") 'swiper)
;; (setq mouse-1-click-follows-link nil) ;; don't accidentally click links
#+end_src

** Projectile

Projectile enriches Emacs's ability to understand git projects

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package ag)
(use-package projectile
  :bind (("s-p" . projectile-command-map)
	 ("C-c p" . projectile-command-map))
  :config (projectile-global-mode)
  (setq projectile-current-project-on-switch 'keep)
  (define-key projectile-mode-map (kbd "s-p") 'projectile-command-map)
  (define-key projectile-mode-map (kbd "C-c p") 'projectile-command-map)
  (projectile-mode +1))
#+end_src

** GPG Config

Emacs can nearly transparently use .gpg encrypted files in emacs. These settings enrich it slightly or make it less effort.

#+begin_src emacs-lisp :tangle ~/.emacs
(setq epa-file-encrypt-to "noonker@gmail.com") ;; Encrypt to my gpg key
(setf epa-pinentry-mode 'loopback) ;; No UI popup. Ask for password in modeline
#+end_src

* Tools
** One Liners

Anything in this section can be described in one sentence.

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package magit)
(use-package transient)
(use-package pass
  :config (global-set-key (kbd "<f12>") 'password-store-copy)) ;; Password Store
(use-package plantuml-mode) ;; Define graphs in code
#+end_src

** Shell

Emacs shell settings

#+begin_src emacs-lisp :tangle ~/.emacs
;; https://timmydouglas.com/2020/12/17/eshell-counsel.html
(defun timmy/counsel-eshell-history-action (cmd)
  "Insert cmd into the buffer"
  (interactive)
  (insert cmd))

(defun timmy/counsel-eshell-history (&optional initial-input)
  "Find command from eshell history.
INITIAL-INPUT can be given as the initial minibuffer input."
  (interactive)
    (ivy-read "Find cmd: " (timmy/eshell-history-list)
              :initial-input initial-input
              :action #'timmy/counsel-eshell-history-action
              :caller 'timmy/counsel-eshell-history))

(defun timmy/eshell-history-list ()
  "return the eshell history as a list"
  (and (or (not (ring-p eshell-history-ring))
	   (ring-empty-p eshell-history-ring))
       (error "No history"))
  (let* ((index (1- (ring-length eshell-history-ring)))
	 (ref (- (ring-length eshell-history-ring) index))
	 (items (list)))
    (while (>= index 0)
      (setq items (cons (format "%s" (eshell-get-history index)) items)
	    index (1- index)
	    ref (1+ ref)))
    items))
;; end

(use-package eshell-git-prompt)

(use-package eshell
  :bind (("C-c e" . counsel-esh-history)
	 ("C-<tab>" . yas-expand-from-trigger-key)
	 ("C-r" . timmy/counsel-eshell-history)
	 ))

(add-hook 'eshell-mode-hook
          (lambda ()
            (progn
	      (evil-local-set-key 'normal (kbd "gr") #'timmy/counsel-eshell-history)
	      (evil-local-set-key 'insert (kbd "C-r") #'timmy/counsel-eshell-history))))

(eshell-git-prompt-use-theme 'robbyrussell) ;; Eshell theme

(setq eshell-error-if-no-glob t
      eshell-hist-ignoredups t
      eshell-save-history-on-exit t
      eshell-prefer-lisp-functions nil
      eshell-destroy-buffer-when-process-dies t)

(defun git-prompt-eshell ()
  "Git a git prompt"
  (let (beg dir git-branch git-dirty end)
    (if (eshell-git-prompt--git-root-dir)
      	(progn
      	  (setq eshell-git-prompt-branch-name (eshell-git-prompt--branch-name))
      	  (setq git-branch
      		(concat
      		 (with-face "git:(" 'eshell-git-prompt-robyrussell-git-face)
      		 (with-face (eshell-git-prompt--readable-branch-name) 'eshell-git-prompt-robyrussell-branch-face)
      		 (with-face ")" 'eshell-git-prompt-robyrussell-git-face)))
      	  (setq git-dirty
      		(when (eshell-git-prompt--collect-status)
      		  (with-face "âœ—" 'eshell-git-prompt-robyrussell-git-dirty-face)))
      	  (concat git-branch git-dirty)) "â˜®" )))

(setq eshell-prompt-function
      (lambda ()
      	(concat
      	 (propertize "â”Œâ”€[" 'face 'org-level-4)
      	 (propertize (user-login-name) 'face 'bold)
      	 (propertize "@" 'face 'org-level-4)
      	 (if (is-tramp-window)
      	     (propertize (file-remote-p default-directory) 'face 'bold)
      	   (propertize (system-name) 'face 'bold))
      	 (propertize "]â”€â”€[" 'face 'org-level-4)
      	 (propertize (format-time-string "%H:%M" (current-time)) 'face 'cursor)
      	 (propertize "]â”€â”€[" 'face 'org-level-4)
      	 (propertize (concat (eshell/pwd)) 'face 'bold)
      	 (propertize "]â”€â”€[" 'face 'org-level-4)
      	 (if (is-tramp-window) "ðŸŒŽ"
      	   (concat (propertize (git-prompt-eshell) 'face 'org-level-6)
      		   (if pyvenv-virtual-env-name (concat (propertize "]â”€â”€[" 'face 'org-level-4)
      						       (propertize (format "venv:%s" pyvenv-virtual-env-name) 'face 'org-level-2)))))
      	 (propertize "]\n" 'face 'org-level-4)
      	 (propertize "â””â”€>" 'face 'org-level-4)
      	 (propertize (if (= (user-uid) 0) " # " " $ ") 'face 'default)
	 )))

(setq eshell-visual-commands '("htop" "vi" "screen" "top" "less"
      			       "more" "lynx" "ncftp" "pine" "tin" "trn" "elm"
      			       "vim" "mitmproxy"))

(setq eshell-visual-subcommands '("git" "log" "diff" "show" "ssh"))

(setenv "PAGER" "cat")

(defalias 'ff 'find-file)
(defalias 'd 'dired)

(defun eshell/clear ()
  (let ((inhibit-read-only t))
    (erase-buffer)))

(defun eshell/gst (&rest args)
  (magit-status (pop args) nil)
  (eshell/echo))   ;; The echo command suppresses output

(use-package esh-autosuggest
  :hook (eshell-mode . esh-autosuggest-mode)
  ;; If you have use-package-hook-name-suffix set to nil, uncomment and use the
  ;; line below instead:
  ;; :hook (eshell-mode-hook . esh-autosuggest-mode)
  :ensure t)
#+end_src


** Tramp

Tramp allows for nearly transparent editing of files on remote machines. Run =C-x C-f= and preface your url with =/ssh:user@host:= to connect to a remote hose and select a file.

#+begin_src emacs-lisp :tangle ~/.emacs
;;; no vc in tramp
(require 'tramp)

(if (not im-at-work)
    (add-to-list 'tramp-remote-path 'tramp-own-remote-path))

(setq remote-file-name-inhibit-cache nil)
(setq vc-ignore-dir-regexp
      (format "\\(%s\\)\\|\\(%s\\)"
	      vc-ignore-dir-regexp
	      tramp-file-name-regexp))
(setq tramp-verbose 1)
(defadvice projectile-on (around exlude-tramp activate)
  "This should disable projectile when visiting a remote file"
  (unless  (--any? (and it (file-remote-p it))
		   (list
		    (buffer-file-name)
		    list-buffers-directory
		    default-directory
		    dired-directory))
    ad-do-it))

(setq projectile-mode-line "Projectile")

;; By default lets be safe in tramp
(add-hook
 'find-file-hook
 (lambda ()
   (when (file-remote-p default-directory)
     (read-only-mode t))))

;; Some more optimizations?
(setq projectile-auto-update-cache nil)
(setq projectile-dynamic-mode-line nil)
#+end_src

** Vterm
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package vterm)
#+end_src

** Dired

#+begin_src emacs-lisp  :tangle ~/.emacs
(use-package dired-preview)
(define-key dired-mode-map (kbd "[") 'dired-preview-mode)
(define-key dired-mode-map (kbd "]") 'image-dired) 

(with-eval-after-load 'dired
  (require 'dired-x)
  ;; Set dired-x global variables here.  For example:
  ;; (setq dired-x-hands-off-my-keys nil)
  )

(setq dired-dwim-target t) ;; When moving a file assume I want to move it to the other dired buffer first
(setq dired-mouse-drag-files t) ;; Drag files from dired emacs

(define-key dired-mode-map (kbd "}") 'wdired-change-to-wdired-mode)
(define-key dired-mode-map (kbd "{") 'find-name-dired)  ;; Quick Search
#+end_src

** SomaFM

Drone Zone >>> All Else

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package somafm)

(defun somafm-volume-control (steps direction)
  (let ((steps (if steps steps 1))
	(direction-key (if (string= "up" direction)
			   "0"
			 "9")))
    (dotimes (foo steps)
      (process-send-string "somafm player" direction-key))))

(defun somafm-volume-up (arg)
  (interactive "P")
  (somafm-volume-control arg "up"))

(defun somafm-volume-down (arg)
  (interactive "P")
  (somafm-volume-control arg "down"))
#+end_src

** ERC

IRC for Emacs

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package erc
  :config
  (setq erc-hide-list '("JOIN" "PART" "QUIT")))

(use-package erc-colorize
  :config
  (erc-colorize-mode 1))

(defun libera ()
  "Connect to IRC"
  (interactive)
  (erc-ssl :server "192.168.50.228" :port "6669" :nick "noonker" :password
	   (format "noonker/libera:%s" (password-store-get "Internet/ZNC")) )
  )

(defun nerds ()
  (interactive)
  (erc-ssl :server "192.168.50.228" :port "6669" :nick "noonker" :password
	   (format "noonker/nerds:%s" (password-store-get "Internet/ZNC"))))

(setq erc-rename-buffers t)
#+end_src

** Elfeed

[[https://github.com/skeeto/elfeed][Elfeed]] is an emacs RSS feed reader. I've blogged about features [[https://noonker.github.io/posts/2020-04-22-elfeed/][here]].

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package elfeed
  :bind (:map elfeed-search-mode-map
	      ("m" . elfeed-mail-todo)
	      ("v" . elfeed-mpv-open)
	      ("t" . elfeed-w3m-open)
	      ("w" . elfeed-eww-open)
	      ("f" . elfeed-firefox-open)
	      ("o" . elfeed-org-open)
	      ("d" . elfeed-youtube-dl)
	      ("a" . elfeed-termux-open)
	      )

  :config
  (defun elfeed-mail-todo (&optional use-generic-p)
    "Mail this to myself for later reading"
    (interactive "P")
    (let ((entries (elfeed-search-selected)))
      (cl-loop for entry in entries
	       do (elfeed-untag entry 'unread)
	       when (elfeed-entry-title entry)
	       do (todo it (elfeed-entry-link entry)))
      (mapc #'elfeed-search-update-entry entries)
      (unless (use-region-p) (forward-line))))

  (defun elfeed-mpv-open (&optional use-generic-p)
    (interactive "P")
    (let ((entries (elfeed-search-selected)))
      (cl-loop for entry in entries
	       do (elfeed-untag entry 'unread)
	       when (caar (elfeed-entry-enclosures entry))
	       do (async-shell-command (format "echo \"%s\" && mpv \"%s\"" it it)
				       (format "*elfeed-mpv: %s*" it)))
      (mapc #'elfeed-search-update-entry entries)
      (unless (use-region-p) (forward-line)))
    )

  (defun elfeed-eww-open (&optional use-generic-p)
    "open with eww"
    (interactive "P")
    (let ((entries (elfeed-search-selected)))
      (cl-loop for entry in entries
	       do (elfeed-untag entry 'unread)
	       when (elfeed-entry-link entry)
	       do (eww-browse-url it))
      (mapc #'elfeed-search-update-entry entries)
      (unless (use-region-p) (forward-line))))

  (defun elfeed-firefox-open (&optional use-generic-p)
    "open with firefox"
    (interactive "P")
    (let ((entries (elfeed-search-selected)))
      (cl-loop for entry in entries
	       do (elfeed-untag entry 'unread)
	       when (elfeed-entry-link entry)
	       do (browse-url-firefox it))
      (mapc #'elfeed-search-update-entry entries)
      (unless (use-region-p) (forward-line))))

  (defun elfeed-youtube-dl (&optional use-generic-p)
    "youtube-dl"
    (interactive "P")
    (let ((entries (elfeed-search-selected)))
      (cl-loop for entry in entries
	       do (elfeed-untag entry 'unread)
	       when (elfeed-entry-link entry)
	       do (yt-dl-it it))
      (mapc #'elfeed-search-update-entry entries)
      (unless (use-region-p) (forward-line))))

  (defun elfeed-org-open (&optional use-generic-p)
    "open with org-web-tools"
    (interactive "P")
    (let ((entries (elfeed-search-selected)))
      (cl-loop for entry in entries
	       do (elfeed-untag entry 'unread)
	       when (elfeed-entry-link entry)
	       do (org-web-tools-read-url-as-org it))
      (mapc #'elfeed-search-update-entry entries)
      (unless (use-region-p) (forward-line))))
  )
#+end_src

*Elfeed Youtube*

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package elfeed-tube
  :ensure t ;; or :straight t
  :after elfeed
  :demand t
  :config
  ;; (setq elfeed-tube-auto-save-p nil) ; default value
  (setq elfeed-tube-auto-fetch-p t)  ; default value
  (elfeed-tube-setup)

  :bind (:map elfeed-show-mode-map
         ("F" . elfeed-tube-fetch)
         ([remap save-buffer] . elfeed-tube-save)
         :map elfeed-search-mode-map
         ("F" . elfeed-tube-fetch)
         ([remap save-buffer] . elfeed-tube-save)))

(use-package elfeed-tube-mpv
  :ensure t ;; or :straight t
  :bind (:map elfeed-show-mode-map
              ("C-c C-f" . elfeed-tube-mpv-follow-mode)
              ("C-c C-w" . elfeed-tube-mpv-where)))
#+end_src

** Gnus

Email client for emacs

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package org-msg
	     :init
	     (setq mail-user-agent 'gnus-user-agent)
	     (setq org-msg-options "html-postamble:nil H:5 num:nil ^:{} toc:nil author:nil email:nil \\n:t"
		   org-msg-startup "hidestars indent inlineimages"
		   org-msg-default-alternatives '((new		. (text html))
						  (reply-to-html	. (text html))
						  (reply-to-text	. (text)))
		   org-msg-convert-citation t)
	     (org-msg-mode))
#+end_src

** Mastodon
#+begin_src emasc-lisp :tangle ~/.emacs
(use-package mastodon)
(setq mastodon-instance-url "https://infosec.exchange"
      mastodon-active-user "noonker")
#+end_src

** Emacs Lisp Packages

These are emacs-lisp packages that I use often enough in scratch-buffers
that I'm requiring them outside of a package

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package ov)
(use-package request)
(use-package cl-lib)
#+end_src

** PCRE2EL

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package pcre2el)
#+end_src

** Mobile

Functions and mobile gadgets

#+begin_src emacs-lisp :tangle ~/.emacs
(defun copy-app-to-desktop (bundle-id)
  (let ((command (format "adb pull $(adb shell pm path %s | cut -d \":\" -f2 | head -n1 ) %s/%s.apk" bundle-id "$HOME/Desktop/" bundle-id)))
    (shell-command command)
    )
  )

(defun start-iproxy ()
  (interactive)
  (async-shell-command "iproxy 2222 22" "*iproxy*"))

(defun iphone-screenshot ()
  (interactive)
  (let  ((screenshot-name (nth 3 (split-string
				  (shell-command-to-string "cd /tmp/ && idevicescreenshot")))))
    (find-file (format "/tmp/%s" screenshot-name))
    )
  )

(defun get-android-apk ()
  (interactive)
  (copy-app-to-desktop
   (completing-read
    "Copy App: "
    (split-string (shell-command-to-string "adb shell pm list packages -3 | sed \"s/package://g\"")))))

(defun start-simulator ()
  (interactive)
  (let ((udid nil)
	(sim-option (completing-read
		     "Start Simulator: "
		     (split-string (shell-command-to-string "xcrun simctl list | grep Shutdown") "\n"))))
    (and (string-match "\\([0-9a-fA-F]\\{8\\}-[0-9a-fA-F]\\{4\\}-[0-9a-fA-F]\\{4\\}-[0-9a-fA-F]\\{4\\}-[0-9a-fA-F]\\{12\\}\\)" sim-option)
	 (setq udid (match-string 1 sim-option)))
    (if udid
	(shell-command (format "open -a Simulator --args -CurrentDeviceUDID %s" udid)))))

(defun android-start-emulator ()
  (interactive)
  
  (let ((avd (completing-read
	      "Emulator: "
	      (split-string
	       (shell-command-to-string "$HOME/Library/Android/sdk/emulator/emulator -list-avds") "\n"))))
    (if avd
	(shell-command (format "$HOME/Library/Android/sdk/emulator/emulator -avd %s -netdelay none -netspeed full -no-snapshot-load&" avd)))
    ))

(defun get-android-view ()
  (interactive)
  (let ((buffer-name "*ui-dump*"))
    (with-current-buffer (get-buffer-create buffer-name)
      (erase-buffer)
      (shell-command "adb shell uiautomator dump")
      (insert (shell-command-to-string "adb shell cat /sdcard/window_dump.xml"))
      (xml-mode)
      (sgml-pretty-print (point-min) (point-max))
      (switch-to-buffer buffer-name)
      )))
#+end_src

** Magit

Magit is git porcelain for Emacs

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package magit
  :config
  (global-set-key (kbd "C-x g") 'magit-status)
  (setq magit-save-repository-buffers nil))
#+end_src

** Counsel
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package counsel)
#+end_src

** Kubernetes

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package kubel)
#+end_src

** Docker
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package docker
  :ensure t
  :bind ("C-c d" . docker))
#+end_src

** Spray Mode

Spray mode is a speed-reading mode

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package spray)
(defun no-properties-pls ()
  (interactive)
  (let ((inhibit-read-only t))
    (set-text-properties (point-min) (point-max) nil)))
(global-set-key (kbd "<f9>") 'spray-mode)
#+end_src

* Programming
** General
#+begin_src emacs-lisp :tangle ~/.emacs
(add-hook 'python-mode-hook 'electric-pair-mode)
#+end_src

** Treesitter
#+begin_src emacs-lisp :tangle ~/.emacs
(setq treesit-language-source-alist
      '((bash "https://github.com/tree-sitter/tree-sitter-bash")
	(cmake "https://github.com/uyha/tree-sitter-cmake")
	(css "https://github.com/tree-sitter/tree-sitter-css")
	(elisp "https://github.com/Wilfred/tree-sitter-elisp")
	(go "https://github.com/tree-sitter/tree-sitter-go")
	(html "https://github.com/tree-sitter/tree-sitter-html")
	(javascript "https://github.com/tree-sitter/tree-sitter-javascript" "master" "src")
	(json "https://github.com/tree-sitter/tree-sitter-json")
	(make "https://github.com/alemuller/tree-sitter-make")
	(markdown "https://github.com/ikatyang/tree-sitter-markdown")
	(python "https://github.com/tree-sitter/tree-sitter-python")
	(toml "https://github.com/tree-sitter/tree-sitter-toml")
	(rust "https://github.com/tree-sitter/tree-sitter-rust")
	(tsx "https://github.com/tree-sitter/tree-sitter-typescript" "master" "tsx/src")
	(typescript "https://github.com/tree-sitter/tree-sitter-typescript" "master" "typescript/src")
	(yaml "https://github.com/ikatyang/tree-sitter-yaml")))
#+end_src

** LSP
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package lsp-ui
  :commands lsp-ui-mode
  :config
  (setq lsp-ui-doc-enable nil)
  (setq lsp-ui-doc-header t)
  (setq lsp-ui-doc-include-signature t)
  (setq lsp-ui-doc-border (face-foreground 'default))
  )
#+end_src

** Flycheck

[[https://www.flycheck.org/en/latest/][Flycheck]] is a syntax checker for emacs

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package flycheck
  :config
  (global-flycheck-mode)
  (setq-default flycheck-disabled-checker '(emacs-lisp-checkdoc)))
#+end_src

** Company

Company is an autocomplete option framework for emacs

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package company
  :config
  (global-company-mode)
  (setq company-dabbrev-downcase 0)
  (setq company-idle-delay 0.38)
  (setq company-minimum-prefix-length 2)

  (defun complete-or-indent ()
    (interactive)
    (if (company-manual-begin)
	(company-complete-common)
      (indent-according-to-mode)))

  (defun indent-or-complete ()
    (interactive)
    (if (looking-at "\\_>")
	(company-complete-common)
      (indent-according-to-mode))))
#+end_src

** Evil?

Lispy mode makes lisp-mode editing significantly more efficent

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package evil
  :ensure t
  :init
  (setq evil-want-integration t) ;; This is optional since it's already set to t by default.
  (setq evil-want-keybinding nil)
  :config
  (evil-mode 1)
  (define-key evil-normal-state-map (kbd "C-e") 'move-end-of-line)
  )

(use-package evil-collection
  :after evil
  :ensure t
  :config
  (evil-collection-init))

(use-package evil-surround
  :ensure t
  :config
  (global-evil-surround-mode 1))

(use-package paredit)

(use-package evil-paredit)

(defun hook-the-parenthesis-things ()
  (paredit-mode 1)
  (evil-paredit-mode 1))

(add-hook 'emacs-lisp-mode-hook 'hook-the-parenthesis-things)

(evil-ex-define-cmd "wq" 'save-and-kill-this-buffer)

(defun save-and-kill-this-buffer()
  (interactive)
  (save-buffer)
  (kill-current-buffer))

(evil-set-initial-state 'magit-status-mode 'emacs)
(evil-set-initial-state 'kubel-mode 'emacs)
#+end_src

** SBCL

Common Lisp configs

#+begin_src emacs-lisp :tangle ~/.emacs
(setq slime-contribs '(slime-fancy))
(if (file-exists-p "~/.roswell/helper.el")
    (load (expand-file-name "~/.roswell/helper.el")))
(setq inferior-lisp-program "ros -Q run")
#+end_src

** C/C++ / Platformio-DCMAKE_PREFIX_PATH=/usr/local/opt/llvm

On MacOS you need to add =-DCMAKE_PREFIX_PATH=/usr/local/opt/llvm= after =cmake= to run =install-irony-server= per [[https://github.com/Sarcasm/irony-mode/issues/167][this]] git issue.

#+begin_src emacs-lisp :tangle ~/.emacs
(add-hook 'c-mode-hook 'lsp)
(add-hook 'c++-mode-hook 'lsp)

(setq gc-cons-threshold (* 100 1024 1024)
      read-process-output-max (* 1024 1024)
      treemacs-space-between-root-nodes nil
      company-minimum-prefix-length 1
      lsp-idle-delay 0.1)  ;; clangd is fast

(add-hook 'c-mode-common-hook (lambda () (lsp) ))

(with-eval-after-load 'lsp-mode)

(use-package irony)
(add-hook 'c++-mode-hook 'irony-mode)
(add-hook 'c-mode-hook 'irony-mode)
(add-hook 'objc-mode-hook 'irony-mode)
(add-hook 'irony-mode-hook 'irony-cdb-autosetup-compile-options)
(add-to-list 'company-backends 'company-irony) ;; Add the required company backend.

;; Enable irony for all c++ files, and platformio-mode only
;; when needed (platformio.ini present in project root).
(add-hook 'c++-mode-hook (lambda ()
			   (irony-mode)
			   (irony-eldoc)
			   (platformio-conditionally-enable)))

;; Use irony's completion functions.
(add-hook 'irony-mode-hook
	  (lambda ()
	    (define-key irony-mode-map [remap completion-at-point]
			'irony-completion-at-point-async)

	    (define-key irony-mode-map [remap complete-symbol]
			'irony-completion-at-point-async)

	    (irony-cdb-autosetup-compile-options)))

;; Setup irony for flycheck.
;;  (add-hook 'flycheck-mode-hook 'flycheck-irony-setup)

(use-package ggtags)
(add-hook 'c-mode-common-hook
	  (lambda ()
	    (when (derived-mode-p 'c-mode 'c++-mode 'java-mode 'asm-mode)
	      (ggtags-mode 1))))

(define-key ggtags-mode-map (kbd "C-c g s") 'ggtags-find-other-symbol)
(define-key ggtags-mode-map (kbd "C-c g h") 'ggtags-view-tag-history)
(define-key ggtags-mode-map (kbd "C-c g r") 'ggtags-find-reference)
(define-key ggtags-mode-map (kbd "C-c g f") 'ggtags-find-file)
(define-key ggtags-mode-map (kbd "C-c g c") 'ggtags-create-tags)
(define-key ggtags-mode-map (kbd "C-c g u") 'ggtags-update-tags)

(define-key ggtags-mode-map (kbd "M-,") 'pop-tag-mark)

(setq-local imenu-create-index-function #'ggtags-build-imenu-index)

(add-to-list 'company-backends 'company-c-headers)
(setq wdired-allow-to-change-permissions t)
#+end_src

** Rust
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package rustic
  :ensure
  :bind (:map rustic-mode-map
              ("M-j" . lsp-ui-imenu)
              ("M-?" . lsp-find-references)
              ("C-c C-c l" . flycheck-list-errors)
              ("C-c C-c a" . lsp-execute-code-action)
              ("C-c C-c r" . lsp-rename)
              ("C-c C-c q" . lsp-workspace-restart)
              ("C-c C-c Q" . lsp-workspace-shutdown)
              ("C-c C-c s" . lsp-rust-analyzer-status))
  :config
  ;; uncomment for less flashiness
  ;; (setq lsp-eldoc-hook nil)
  ;; (setq lsp-enable-symbol-highlighting nil)
  ;; (setq lsp-signature-auto-activate nil)

  ;; comment to disable rustfmt on save
  (setq rustic-format-on-save t)
  (add-hook 'rustic-mode-hook 'rk/rustic-mode-hook))

(defun rk/rustic-mode-hook ()
  ;; so that run C-c C-c C-r works without having to confirm, but don't try to
  ;; save rust buffers that are not file visiting. Once
  ;; https://github.com/brotzeit/rustic/issues/253 has been resolved this should
  ;; no longer be necessary.
  (when buffer-file-name
    (setq-local buffer-save-without-query t))
  (add-hook 'before-save-hook 'lsp-format-buffer nil t))
#+end_src

** Go
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package go-mode)

(add-hook 'go-mode-hook 'lsp-deferred)
(add-hook 'go-mode-hook 'subword-mode)
(add-hook 'before-save-hook 'gofmt-before-save)

(add-hook 'go-mode-hook (lambda ()
                          (setq tab-width 4)
                          (flycheck-add-next-checker 'lsp 'go-vet)
                          (flycheck-add-next-checker 'lsp 'go-staticcheck)))
#+end_src

** Python

Python + LSP

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package envrc
  :hook (after-init . envrc-global-mode))

(use-package python
  :bind (("C-c C-c" . python-shell-send-region)))

(use-package lsp-pyright
  :ensure t
  :hook (python-mode . (lambda ()
                         (require 'lsp-pyright)
                         (lsp))))  ; or lsp-deferred
(use-package elpy
  :ensure t
  :init
  (elpy-enable)
  (pyvenv-tracking-mode)
  (setq elpy-rpc-virtualenv-path 'current)
  (setq elpy-shell-starting-directory 'current-directory) ;; default is 'project-root 
  (setenv "WORKON_HOME" (file-name-concat (file-truename "~") ".virtualenvs"))
  (setq python-shell-interpreter "python"))

(add-hook 'elpy-mode-hook (lambda ()
                            (add-hook 'before-save-hook
                                      'elpy-black-fix-code nil t)))

(use-package dap-mode
  :after lsp-mode
  :commands dap-debug
  :hook ((python-mode . dap-ui-mode)
	 (python-mode . dap-mode))
  :config
  (eval-when-compile
    (require 'cl))
  (require 'dap-python)
  (require 'dap-lldb)
  (dap-auto-configure-mode)
  (setq dap-python-debugger 'debugpy)
  )

(evil-define-key 'normal python-mode-map "gjd" 'dap-debug)
(evil-define-key 'normal python-mode-map "gjl" 'dap-continue)
(evil-define-key 'normal python-mode-map "gjj" 'dap-step-in)
(evil-define-key 'normal python-mode-map "gjk" 'dap-step-out)
(evil-define-key 'normal python-mode-map "gjn" 'dap-next)
(evil-define-key 'normal python-mode-map "gjD" 'dap-disconnect)
(evil-define-key 'normal python-mode-map "gjb" 'dap-breakpoint-toggle)
(evil-define-key 'normal python-mode-map "gjr" 'dap-ui-repl)
(evil-define-key 'visual python-mode-map "gje" 'dap-eval-region)
(evil-define-key 'visual python-mode-map "gjr" 'dap-eval-variable-in-buffer)
#+end_src

** Platformio

Platformio is for programming embedded devices

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package platformio-mode)
#+end_src

** Typescript

Typescript + LSP

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package typescript-mode)

(use-package tide
  :ensure t
  :after (typescript-mode flycheck)
  :hook ((typescript-mode . tide-setup)
	 (typescript-mode . tide-hl-identifier-mode)
	 ;; (before-save . tide-format-before-save)
	 ))
#+end_src

** Clojure

Clojure + LSP

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package lsp-treemacs)
(use-package clj-refactor)

(add-hook 'clojure-mode-hook 'lsp)
(add-hook 'clojurescript-mode-hook 'lsp)
(add-hook 'clojurec-mode-hook 'lsp)

(setq gc-cons-threshold (* 100 1024 1024)
      read-process-output-max (* 1024 1024)
      treemacs-space-between-root-nodes nil
      company-minimum-prefix-length 1
      lsp-lens-enable t
      lsp-signature-auto-activate nil
      lsp-enable-indentation nil ; uncomment to use cider indentation instead of lsp
      lsp-enable-completion-at-point nil ; uncomment to use cider completion instead of lsp
      )

(use-package clojure-mode
  :ensure t
  :mode (("\\.clj\\'" . clojure-mode)
	 ("\\.edn\\'" . clojure-mode)
	 ))

(use-package cider
  :ensure t
  :defer t
  :init (add-hook 'cider-mode-hook #'clj-refactor-mode)
  :diminish subword-mode
  :config
  (setq nrepl-log-messages t
	cider-repl-display-in-current-window t
	cider-repl-use-clojure-font-lock t
	cider-prompt-save-file-on-load 'always-save
	cider-font-lock-dynamically '(macro core function var)
	nrepl-hide-special-buffers t
	cider-overlays-use-font-lock t)
  (cider-repl-toggle-pretty-printing))

(add-hook 'clojure-mode-hook #'paredit-mode)
(add-hook 'clojure-mode-hook #'subword-mode)
(add-hook 'clojure-mode-hook #'eldoc-mode)
#+end_src

** Json
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package json)
(use-package json-mode)
(use-package counsel-jq) ;; Query json file with jq + counsel
#+end_src

** Yaml
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package yaml)
#+end_src

** RMSBolt
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package rmsbolt)
#+end_src

* PDF

** PDF Tools
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package pdf-tools
  :straight t
  :config
  (pdf-tools-install))

(add-hook 'pdf-view-mode-hook (lambda () (progn (display-line-numbers-mode -1))))
#+end_src

** \LaTeX
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package tex
  :straight auctex)

;; CDLatex settings
(use-package cdlatex
  :ensure t
  :hook (LaTeX-mode . turn-on-cdlatex)
  :bind (:map cdlatex-mode-map 
              ("<tab>" . cdlatex-tab)))

;; Yasnippet settings
(use-package yasnippet
  :ensure t
  :hook ((LaTeX-mode . yas-minor-mode)
         (post-self-insert . my/yas-try-expanding-auto-snippets))
  :config
  (use-package warnings
    :config
    (cl-pushnew '(yasnippet backquote-change)
                warning-suppress-types
                :test 'equal))

  (setq yas-triggers-in-field t)

  (add-to-list 'yas-snippet-dirs (file-name-concat "~/git" "dotfiles/snippets"))
  
  ;; Function that tries to autoexpand YaSnippets
  ;; The double quoting is NOT a typo!
  (defun my/yas-try-expanding-auto-snippets ()
    (when (and (boundp 'yas-minor-mode) yas-minor-mode)
      (let ((yas-buffer-local-condition ''(require-snippet-condition . auto)))
        (yas-expand)))))

(use-package yasnippet-snippets)

(yas-global-mode)

(yas-reload-all)

;; CDLatex integration with YaSnippet: Allow cdlatex tab to work inside Yas
;; fields
(use-package cdlatex
  :hook ((cdlatex-tab . yas-expand)
         (cdlatex-tab . cdlatex-in-yas-field))
  :config
  (use-package yasnippet
    :bind (:map yas-keymap
		("<tab>" . yas-next-field-or-cdlatex)
		("TAB" . yas-next-field-or-cdlatex))
    :config
    (defun cdlatex-in-yas-field ()
      ;; Check if we're at the end of the Yas field
      (when-let* ((_ (overlayp yas--active-field-overlay))
                  (end (overlay-end yas--active-field-overlay)))
        (if (>= (point) end)
            ;; Call yas-next-field if cdlatex can't expand here
            (let ((s (thing-at-point 'sexp)))
              (unless (and s (assoc (substring-no-properties s)
                                    cdlatex-command-alist-comb))
                (yas-next-field-or-maybe-expand)
                t))
          ;; otherwise expand and jump to the correct location
          (let (cdlatex-tab-hook minp)
            (setq minp
                  (min (save-excursion (cdlatex-tab)
                                       (point))
                       (overlay-end yas--active-field-overlay)))
            (goto-char minp) t))))

    (defun yas-next-field-or-cdlatex nil
      (interactive)
      "Jump to the next Yas field correctly with cdlatex active."
      (if
          (or (bound-and-true-p cdlatex-mode)
              (bound-and-true-p org-cdlatex-mode))
          (cdlatex-tab)
        (yas-next-field-or-maybe-expand)))))

(use-package latex-preview-pane)

(with-eval-after-load 'org
  (progn
    (add-to-list 'org-latex-packages-alist '("" "tcolorbox" t))
    (add-to-list 'org-latex-packages-alist '("" "minted" t))
    (add-to-list 'org-latex-packages-alist '("" "lipsum" t))))

(setq org-preview-latex-default-process 'imagemagick)

(use-package org-contrib
  :config (require 'ox-extra)
  (ox-extras-activate '(ignore-headlines)))

(setq org-format-latex-options (plist-put org-format-latex-options :scale 2.0))


(evil-define-key 'normal org-mode-map "gjl" 'org-latex-preview)
#+end_src

** Org Mode

*** Verb
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package verb)
#+end_src

*** Org One Liners
#+begin_src emacs-lisp :tangle ~/.emacs
(setq org-fontify-whole-heading-line t)
(setq org-startup-folded t)


(setq org-directory "~/org")
(setq org-agenda-basedir "~/org/tasks")

(add-hook 'org-mode-hook (lambda () (org-bullets-mode 1))) ;; Add special bullets
(setq org-startup-align-all-tables t) ;; Aligns tables when a file is opened
(setq org-startup-shrink-all-tables t) ;; Shrinks tables according to <x> tags in the column headers
(setq org-clock-out-switch-to-state "TODO")
(setq org-clock-out-remove-zero-time-clocks nil)
(setq org-startup-indented t) ;; Indent content of blocks to visual indent
(setq org-edit-src-content-indentation 0)
(eval-after-load 'org
  (add-hook 'org-babel-after-execute-hook 'org-redisplay-inline-images))
(setq org-startup-with-inline-images t)

(use-package hl-todo)
(setq org-src-fontify-natively t)

(global-set-key (kbd "C-c a") 'org-agenda)
(global-set-key (kbd "C-c n n") 'org-capture)
(global-set-key (kbd "C-c n r n") 'org-roam-capture)
(global-set-key (kbd "C-c n r f") 'org-roam-node-find)
(global-set-key (kbd "C-c n r i") 'org-roam-node-insert)

(evil-global-set-key 'normal "gl" 'org-store-link)

(setq personal/node-types '('ctf
			    'investigation
			    'demo
			    'poetry
			    'music
			    'music-analysis))

(defun org-today-update-day ()
  (interactive)
  (setq org-archive-location (format "%s/archive/%s.org::" org-agenda-basedir (format-time-string "%Y-%m-%d"))))

(org-today-update-day)
#+end_src

*** Org Download
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package org-download
  :init
  (progn
    (setq org-image-actual-width (list 900))))
#+end_src

*** Org Transclusion
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package org-transclusion
  :after org)
#+end_src

*** Org Babel Packages
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package ob-sql-mode)
(use-package ob-typescript)
(use-package ob-markdown)
(use-package mermaid-mode)
(use-package ob-mermaid)
(use-package ob-d2)
#+end_src

*** Org Babel
#+begin_src emacs-lisp :tangle ~/.emacs
(org-babel-do-load-languages
 'org-babel-load-languages
 '((dot . t)
   (python . t)
   (verb . t)
   (mermaid . t)
   (d2 . t)
   (plantuml . t)
   (shell . t)
   (sql . t)
   (js . t)
   (sqlite . t)
   (gnuplot . t)
   (typescript . t)
   (latex . t)
   (C . t)
   (org . t)
   (clojure . t)
   ))

(use-package ox-slack)

(setq org-babel-clojure-backend 'cider)

(setq org-plantuml-jar-path
      (expand-file-name  "/opt/homebrew/Cellar/plantuml/1.2022.6/libexec/plantuml.jar"))

(setq org-confirm-babel-evaluate nil)
#+end_src

*** Org Agenda
#+begin_src emacs-lisp :tangle ~/.emacs
(setq org-archive-file-header-format nil)

(defun  org-init-agenda ()
  (interactive)
  (let ((initial '(("backlog.org" nil)
                   ("recurring.org" nil)
                   ("today.org" nil)
                   ("projects" t)
                   ("archive" t)))
        (todostr "#+TODO: TODO STRT | DONE WONTDO"))
    (if (not (file-directory-p org-agenda-basedir))
        (make-directory org-agenda-basedir))

    (dolist (element initial)
      (let ((name  (nth 0 element))
            (isdir (nth 1 element)))
        ;; If the file doesn't exist and not flagged as dir
        (if (and (not isdir)
                 (not (file-directory-p (format "%s/%s" org-agenda-basedir name))))
            (write-region todostr nil (format "%s/%s" org-agenda-basedir name)))

        ;; If the file doesn't exist and is flagged as dir
        (if (and isdir
                 (not (file-directory-p (format "%s/%s" org-agenda-basedir name))))
            (make-directory (format "%s/%s" org-agenda-basedir name)))))))


(setq org-agenda-files (append (list (format "%s/backlog.org" org-agenda-basedir)
                                     (format "%s/recurring.org" org-agenda-basedir)
                                     (format "%s/meetings.org" org-agenda-basedir)
                                     (format "%s/today.org" org-agenda-basedir))
                               (directory-files-recursively (format "%s/projects/" org-agenda-basedir) "^[0-9a-zA-Z\-_]*?\.org$")
                               ))

(setq org-archive-location (format "%s/archive/%s.org::" org-agenda-basedir (format-time-string "%Y-%m-%d")))

(defun org-agenda-new-day ()
  (interactive)
  (with-current-buffer (find-file (format "%s/today.org" org-agenda-basedir))
    (mark-whole-buffer)
    (kill-region (mark) (point))
    (if (= (buffer-size) 0) (insert "#+CREATED: %U\n#+LAST_MODIFIED: %U#+TODO: TODO IN-PROGRESS | DONE WONTDO\n\n* Tasks\n* Thoughts\n")))
  (org-agenda))

(defun org-complex-tasks ()
  (interactive)
  (let ((tasks  (quote ("TODO Create Jira Ticket"
                        "TODO Documentation"
                        "TODO Close Jira Ticket"))))
    (org-end-of-line)
    (insert " [/]")
    (org-insert-heading)
    (org-demote-subtree)
    (insert (car tasks))
    (dolist (element (cdr tasks))
      (org-insert-heading)
      (insert element))))
#+end_src

*** Org Refile
#+begin_src emacs-lisp :tangle ~/.emacs
(defun directory-files-if-exists (dir)
  (if (file-directory-p dir)
      (directory-files dir t)
    ""))

(setq org-blogpost-directory (directory-files-if-exists (format "%s/blog/content/posts" org-directory)))
(setq org-cheatsheet-directory (directory-files-if-exists (format "%s/cheatsheet" org-directory)))
(setq org-notes-directory (directory-files-if-exists (format "%s/notes" org-directory)))
(setq org-refile-use-outline-path t)                  ; Show full paths for refiling
(setq org-outline-path-complete-in-steps nil)         ; Refile in a single go
(setq org-refile-targets '((org-agenda-files :maxlevel . 3)))
(setq org-refile-allow-creating-parent-nodes t)
(setq org-refile-allow-creating-parent-nodes 'confirm)
(setq org-refile-use-outline-path 'file)
#+end_src

*** Org Capture
#+begin_src emacs-lisp :tangle ~/.emacs
(setq org-capture-templates
      `(("b" "Backlog" entry (file+headline (lambda () (format "%s/backlog.org" org-agenda-basedir)) "Backlog")
	 "** TODO %?\n  %i\n  %a")
	("t" "Today" entry (file+headline (lambda () (format "%s/today.org" org-agenda-basedir)) "Tasks")
	 "\n** TODO %?\n SCHEDULED: %t")
	("n" "Now" entry (file+headline (lambda () (format "%s/today.org" org-agenda-basedir)) "Tasks")
	 "\n** TODO %?\n SCHEDULED: %t" :clock-in t :clock-keep t)
	("i" "Interrupt" entry (file+headline (lambda () (format "%s/today.org" org-agenda-basedir)) "Tasks")
	 "\n** TODO %?\n SCHEDULED: %t" :clock-in t :clock-resume t)
	("c" "Cookbook" entry (file "~/org/cookbook.org")
	 "%(org-chef-get-recipe-from-url)"
	 :empty-lines 1)
	("m" "Manual Cookbook" entry (file "~/org/cookbook.org")
	 "* %^{Recipe title: }\n  :PROPERTIES:\n  :source-url:\n  :servings:\n  :prep-time:\n  :cook-time:\n  :ready-in:\n  :END:\n** Ingredients\n   %?\n** Directions\n\n")
	("p" "Protocol" entry (file+headline ,(concat org-directory "notes.org") "Inbox")
	 "* %^{Title}\nSource: %u, %c\n #+BEGIN_QUOTE\n%i\n#+END_QUOTE\n\n\n%?")
	("L" "Protocol Link" entry (file+headline ,(concat org-directory "notes.org") "Inbox")
	 "* %? [[%:link][%(transform-square-brackets-to-round-ones \"%:description\")]]\n")
	("j" "Journal" entry (file+headline (lambda () (format "%s/journal/%s.org.gpg" org-directory (format-time-string "%Y-%m-%d"))) "Journal") "")
	("B" "Blog Post" plain (file (lambda () (format "%s/blog/noonker/content/posts/%s-%s.org" org-directory (format-time-string "%Y-%m-%d") (replace-regexp-in-string " " "-" (downcase (read-string "Name: ")))))) 
	 ,(format "#+title: TITLE\n#+subtitle:\n#+date: %s\n#+tags[]: tech, emacs\n#+draft: false\n\n" (format-time-string "%Y-%m-%d")))
	)
      )

(setq org-roam-capture-templates '(
				   ("n" "notes" plain "%?"
				    :target (file+head "notes/%<%Y%m%d%H%M%S>-${slug}/${slug}.org"
						       "#+title: ${title}\n#+ROAM_ALIAS:\n#+ROAM_TAGS: \n#+CREATED: %U\n#+LAST_MODIFIED: %U\n\n")
				    :unnarrowed t)
				   ("e" "encrypted notes" plain "%?"
				    :target (file+head "notes/%<%Y%m%d%H%M%S>-${slug}/${slug}.org.gpg"
						       "#+title: ${title}\n#+ROAM_ALIAS:\n#+ROAM_TAGS: \n#+CREATED: %U\n#+LAST_MODIFIED: %U\n\n")
				    :unnarrowed t)
				   ))
#+end_src

*** Org Roam
#+begin_src emacs-lisp :tangle ~/.emacs
(setq org-roam-directory "~/org/")
(use-package websocket)

(use-package org-roam-ui
  :after org-roam ;; or :after org
  ;;         normally we'd recommend hooking orui after org-roam, but since org-roam does not have
  ;;         a hookable mode anymore, you're advised to pick something yourself
  ;;         if you don't care about startup time, use
  ;;  :hook (after-init . org-roam-ui-mode)
  :config
  (setq org-roam-ui-sync-theme t
	org-roam-ui-follow t
	org-roam-ui-update-on-save t
	org-roam-ui-open-on-start t
	))

(org-roam-db-autosync-mode) ;; Automatically update the org roam database 
#+end_src

*** Org Protocol
#+begin_src emacs-lisp :tangle ~/.emacs
(defun transform-square-brackets-to-round-ones(string-to-transform)
  "Transforms [ into ( and ] into ), other chars left unchanged."
  (concat
   (mapcar #'(lambda (c) (if (equal c ?\[) ?\( (if (equal c ?\]) ?\) c))) string-to-transform))
  )

#+end_src

*** Org Packages
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package org-bullets)
(use-package org-web-tools)
#+end_src

*** Org eXport
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package ox-reveal
  :config
  (setq org-reveal-root "file:///home/user/git/reveal.js"))

(use-package ox-confluence)

(setq org-export-with-drawers nil)

(setq org-src-fontify-natively t)
(setq org-latex-listings 'minted
      org-latex-pdf-process
      '("pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"
        "pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"))

#+end_src

*** Org + Hugo

Blogging with hugo

#+begin_src emacs-lisp :tangle ~/.emacs
(defun replace-regexp-entire-buffer (pattern replacement)
  "Perform regular-expression replacement throughout buffer."
  (interactive
   (let ((args (query-replace-read-args "Replace" t)))
     (setcdr (cdr args) nil)    ; remove third value returned from query---args
     args))
  (save-excursion
    (goto-char (point-min))
    (while (re-search-forward pattern nil t)
      (replace-match replacement))))

(defun blog-cleanup-buffer ()
  (interactive)
  (replace-regexp-entire-buffer "../../static" ""))

(defun blog-push-to-git ()
  (interactive)
  (async-shell-command (format "cd %s/blog/noonker/public/ && git add . && git commit -m \"update\" && git push") "Blog-Update")
  )

(defun insert-blog-tag ()
  (interactive)
  (insert (completing-read "tag: " '("thoughts" "microblogging" "emacs" "tech" "hell" "accordion" "ctf" "security" "tools" "email" "privacy"))))
#+end_src

** Easydraw

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package edraw-org
  :straight (:host github :repo "misohena/el-easydraw" :files ("dist" "*.el"))
  :config (with-eval-after-load 'org
	    (require 'edraw-org)
	    (edraw-org-setup-default)))
#+end_src

** Markdown
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package markdown-mode)
#+end_src

** Flyspell
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package flyspell
  :config
  (setq ispell-program-name "aspell"
	ispell-list-command "--list")
  (dolist (hook '(text-mode-hook))
    (add-hook hook (lambda () (flyspell-mode 1))))
  (add-hook 'python-mode-hook
	    (lambda ()
	      (flyspell-prog-mode)
	      ))
  )
#+end_src

** Languagetool

Run =brew install languagetool= to install on mac

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package langtool
  :config
  (setq langtool-bin "/usr/local/bin/languagetool")
  (setq langtool-http-server-host "localhost"
	langtool-http-server-port 8081)
  )
#+end_src

* Custom Functions
** Mac Open

Replace spotlight with emacs

#+begin_src emacs-lisp :tangle ~/.emacs
(defun mac-open ()
  "Open a mac application... In Emacs.... why not"
  (interactive)
  (call-process-shell-command
   (format " open /Applications/%s"
	   (completing-read
	    "Mac Open: "
	    (directory-files "/Applications")))))
#+end_src

** Youtube Download

Download vidoes with youtube-dl

#+begin_src emacs-lisp :tangle ~/.emacs
(defun yt-dl-it (url)
  "Downloads the URL in an async shell"
  (let ((default-directory "~/Videos"))
    (async-shell-command (format "yt-dlp %s" url))))
#+end_src

** Image to Text

Use tesseract-ocr to turn an image into text and insert it into this buffer

#+begin_src emacs-lisp :tangle ~/.emacs
(defun image-to-text ()
  (interactive)
  (if buffer-file-name
      (progn
	;; Convert the file to a tif file for tesseract consumption.
	(shell-command (concat "convert " buffer-file-name " -resize 400% -type Grayscale " buffer-file-name ".tif"))
	;; Convert the file from tif to txt using tesseract.
	(shell-command (concat "tesseract -l eng " buffer-file-name ".tif " buffer-file-name))
	;; Delete the tif file artifact.
	(shell-command (concat "rm " buffer-file-name ".tif"))
	;; Open the text file in buffer, this should be the text found in the image converted.
	(find-file (concat buffer-file-name ".txt")))))
#+end_src

** CNC Mode

These functions enable options where you can have one buffer of commands to run and several other open buffers that the commands will be sent to.

#+begin_src emacs-lisp :tangle ~/.emacs
;; cnc-command
(defun visible-buffers ()
  "Definition"
  (interactive)
  (mapcar '(lambda (window) (buffer-name (window-buffer window))) (window-list)))

(defun all-buffers-except-this ()
  "Definition"
  (interactive)
  (delete (buffer-name (current-buffer)) (visible-buffers))
  )

(defun cnc-from-file ()
  "A command to run commands on the other open buffers"
  (interactive)
  (dolist (elt (all-buffers-except-this))
    (comint-send-string elt (format "%s\n" (thing-at-point `line))))
  (next-line)
  t
  )

(defun cnc-prompt (cmd)
  "A command to run commands on the other open buffers"
  (interactive "sCmd: ")
  (dolist (elt (visible-buffers))
    (comint-send-string elt (format "%s\n" cmd)))
  )

(defun split-cnc (number)
  (interactive "N")
  "Function to split windows into one major window and multiple minor ansi-terms"
  (split-window-horizontally)
  (other-window 1)
  (ansi-term "/bin/bash" "cnc")
  (while (> number 1)
    (split-window-vertically)
    (ansi-term "/bin/bash" "cnc")
    (other-window 1)
    (setq number (+ -1 number)))
  (ansi-term "/bin/bash" "cnc")
  (other-window 1)
  (balance-windows))

(global-set-key (kbd "C-c y") `cnc-prompt)
(global-set-key (kbd "C-c C-.") `cnc-from-file)
#+end_src

** Typit
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package speed-type)
#+end_src

** Misc

These functions are helpers and should be self explanitory

#+begin_src emacs-lisp :tangle ~/.emacs
(defun is-tramp-window ()
  (if (file-remote-p default-directory) t nil))

(defun no-fonts-pls ()
  (interactive)
  (let ((inhibit-read-only t))
    (set-text-properties (point-min) (point-max) nil)))

(defun what-is-my-ip ()
  (interactive)
  (message "IP: %s"
	   (with-current-buffer (url-retrieve-synchronously "https://api.`ipify.org")
	     (buffer-substring (+ 1 url-http-end-of-headers) (point-max)))))

(defun character-below ()
  (save-excursion
    (next-line)
    (string (char-after (point)))))

(defun replace-below (cur rep bel)
  (interactive)
  (let ((pos 1)
	(tmp))
    (while (< pos (point-max))
      (if (equal cur (string (char-after pos)))
	  (if (equal bel (character-above))
	      (progn (delete-char 1) (insert rep))
	    ))
      (setq pos (+ 1 pos))
      (goto-char pos)
      )))

(defun ruthless-kill ()
  "Kill the line without copying it"
  (interactive)
  (delete-region (point) (line-end-position)))

(global-set-key (kbd "C-x j") 'kill-current-buffer)
(global-set-key (kbd "C-c k") 'ruthless-kill)

(defun insert-current-date ()
  "Insert the current date"
  (interactive)
  (insert (shell-command-to-string "echo -n $(date +%Y-%m-%d)")))

(defun selenium()
  (interactive)
  (save-excursion
    (async-shell-command "java -jar $HOME/Documents/selenium.jar")))

(defun toggle-maximize-buffer ()
  "Maximize buffer"
  (interactive)
  (if (= 1 (length (window-list)))
      (jump-to-register '_)
    (progn
      (set-register '_ (list (current-window-configuration)))
      (delete-other-windows))))

(defun untabify-buffer ()
  (interactive)
  (untabify (point-min) (point-max)))

(defun indent-buffer ()
  (interactive)
  (indent-region (point-min) (point-max)))

(defun cleanup-buffer ()
  "Perform a bunch of operations on the whitespace content of a buffer."
  (interactive)
  (indent-buffer)
  (untabify-buffer)
  (delete-trailing-whitespace))

;; Easy window splitting
(defun split-maj-min (number)
  (interactive "N")
  "Function to split windows into one major window and multiple minor windows"
  (split-window-horizontally)
  (other-window 1)
  (while (> number 1)
    (setq number (+ -1 number))
    (split-window-vertically))
  (balance-windows))

(defun sudo ()
  "Use TRAMP to `sudo' the current buffer"
  (interactive)
  (when buffer-file-name
    (find-alternate-file
     (concat "/sudo:root@localhost:"
	     buffer-file-name))))

(defun proxy (text &optional port)
  (interactive "sHost: ")
  (async-shell-command (format "ssh -D 1337 -C -q -N %s" text) (format "*proxy: %s*" text)))

(defun todo (text &optional body)
  (interactive "sTodo: ")
  (compose-mail-other-window "noonker@pm.me" text)
  (mail-text)
  (if body
      (insert body))
  (message-send-and-exit)
  )

(global-set-key (kbd "C-c C-t") 'todo)

(defun noonker/flatten-category (category)
  (mapcar (lambda (item) (cons (car category) item)) (cadr category)))

(defun noonker/flatten-bookmarks (bookmarks)
  (mapcan 'noonker/flatten-category bookmarks))

(defun noonker/bookmarks-complete (bookmarks)
  (let* ((choice (completing-read
		 "Bookmarks:"
		 (mapcar (lambda (item) (string-join item "	"))
			 (noonker/flatten-bookmarks bookmarks))))
	 (url (nth 2 (split-string choice "	"))))
    (browse-url url)))
#+end_src

** Doom Modeline

The doom modeline looks better than the stock emacs modeline.

#+begin_src emacs-lisp :tangle ~/.emacs
(use-package doom-modeline
  :config (doom-modeline-mode 1))

;; If non-nil, cause imenu to see `doom-modeline' declarations.
;; This is done by adjusting `lisp-imenu-generic-expression' to
;; include support for finding `doom-modeline-def-*' forms.
;; Must be set before loading doom-modeline.
(setq doom-modeline-support-imenu t)

;; How wide the mode-line bar should be. It's only respected in GUI.
(setq doom-modeline-bar-width 4)

;; Whether to use hud instead of default bar. It's only respected in GUI.
(setq doom-modeline-hud nil)

;; The limit of the window width.
;; If `window-width' is smaller than the limit, some information won't be
;; displayed. It can be an integer or a float number. `nil' means no limit."
(setq doom-modeline-window-width-limit 85)

;; How to detect the project root.
;; nil means to use `default-directory'.
;; The project management packages have some issues on detecting project root.
;; e.g. `projectile' doesn't handle symlink folders well, while `project' is unable
;; to hanle sub-projects.
;; You can specify one if you encounter the issue.
(setq doom-modeline-project-detection 'auto)

;; Determines the style used by `doom-modeline-buffer-file-name'.
;;
;; Given ~/Projects/FOSS/emacs/lisp/comint.el
;;   auto => emacs/l/comint.el (in a project) or comint.el
;;   truncate-upto-project => ~/P/F/emacs/lisp/comint.el
;;   truncate-from-project => ~/Projects/FOSS/emacs/l/comint.el
;;   truncate-with-project => emacs/l/comint.el
;;   truncate-except-project => ~/P/F/emacs/l/comint.el
;;   truncate-upto-root => ~/P/F/e/lisp/comint.el
;;   truncate-all => ~/P/F/e/l/comint.el
;;   truncate-nil => ~/Projects/FOSS/emacs/lisp/comint.el
;;   relative-from-project => emacs/lisp/comint.el
;;   relative-to-project => lisp/comint.el
;;   file-name => comint.el
;;   buffer-name => comint.el<2> (uniquify buffer name)
;;
;; If you are experiencing the laggy issue, especially while editing remote files
;; with tramp, please try `file-name' style.
;; Please refer to https://github.com/bbatsov/projectile/issues/657.
(setq doom-modeline-buffer-file-name-style 'auto)

;; Whether display icons in the mode-line.
;; While using the server mode in GUI, should set the value explicitly.
(setq doom-modeline-icon t)

;; Whether display the icon for `major-mode'. It respects option `doom-modeline-icon'.
(setq doom-modeline-major-mode-icon t)

;; Whether display the colorful icon for `major-mode'.
;; It respects `nerd-icons-color-icons'.
(setq doom-modeline-major-mode-color-icon t)

;; Whether display the icon for the buffer state. It respects option `doom-modeline-icon'.
(setq doom-modeline-buffer-state-icon t)

;; Whether display the modification icon for the buffer.
;; It respects option `doom-modeline-icon' and option `doom-modeline-buffer-state-icon'.
(setq doom-modeline-buffer-modification-icon t)

;; Whether display the lsp icon. It respects option `doom-modeline-icon'.
(setq doom-modeline-lsp-icon t)

;; Whether display the time icon. It respects option `doom-modeline-icon'.
(setq doom-modeline-time-icon t)

;; Whether display the live icons of time.
;; It respects option `doom-modeline-icon' and option `doom-modeline-time-icon'.
(setq doom-modeline-time-live-icon t)

;; Whether to use unicode as a fallback (instead of ASCII) when not using icons.
(setq doom-modeline-unicode-fallback nil)

;; Whether display the buffer name.
(setq doom-modeline-buffer-name t)

;; Whether highlight the modified buffer name.
(setq doom-modeline-highlight-modified-buffer-name t)

;; When non-nil, mode line displays column numbers zero-based.
;; See `column-number-indicator-zero-based'.
(setq doom-modeline-column-zero-based t)

;; Specification of \"percentage offset\" of window through buffer.
;; See `mode-line-percent-position'.
(setq doom-modeline-percent-position '(-3 "%p"))

;; Format used to display line numbers in the mode line.
;; See `mode-line-position-line-format'.
(setq doom-modeline-position-line-format '("L%l"))

;; Format used to display column numbers in the mode line.
;; See `mode-line-position-column-format'.
(setq doom-modeline-position-column-format '("C%c"))

;; Format used to display combined line/column numbers in the mode line. See `mode-line-position-column-line-format'.
(setq doom-modeline-position-column-line-format '("%l:%c"))

;; Whether display the minor modes in the mode-line.
(setq doom-modeline-minor-modes nil)

;; If non-nil, a word count will be added to the selection-info modeline segment.
(setq doom-modeline-enable-word-count nil)

;; Major modes in which to display word count continuously.
;; Also applies to any derived modes. Respects `doom-modeline-enable-word-count'.
;; If it brings the sluggish issue, disable `doom-modeline-enable-word-count' or
;; remove the modes from `doom-modeline-continuous-word-count-modes'.
(setq doom-modeline-continuous-word-count-modes '(markdown-mode gfm-mode org-mode))

;; Whether display the buffer encoding.
(setq doom-modeline-buffer-encoding t)

;; Whether display the indentation information.
(setq doom-modeline-indent-info nil)

;; Whether display the total line numberã€‚
(setq doom-modeline-total-line-number nil)

;; If non-nil, only display one number for check information if applicable.
(setq doom-modeline-check-simple-format t)

;; The maximum number displayed for notifications.
(setq doom-modeline-number-limit 99)

;; The maximum displayed length of the branch name of version control.
(setq doom-modeline-vcs-max-length 12)

;; Whether display the workspace name. Non-nil to display in the mode-line.
(setq doom-modeline-workspace-name t)

;; Whether display the perspective name. Non-nil to display in the mode-line.
(setq doom-modeline-persp-name t)

;; If non nil the default perspective name is displayed in the mode-line.
(setq doom-modeline-display-default-persp-name nil)

;; If non nil the perspective name is displayed alongside a folder icon.
(setq doom-modeline-persp-icon t)

;; Whether display the `lsp' state. Non-nil to display in the mode-line.
(setq doom-modeline-lsp t)

;; Whether display the GitHub notifications. It requires `ghub' package.
(setq doom-modeline-github nil)

;; The interval of checking GitHub.
(setq doom-modeline-github-interval (* 30 60))

;; Whether display the modal state.
;; Including `evil', `overwrite', `god', `ryo' and `xah-fly-keys', etc.
(setq doom-modeline-modal t)

;; Whether display the modal state icon.
;; Including `evil', `overwrite', `god', `ryo' and `xah-fly-keys', etc.
(setq doom-modeline-modal-icon t)

;; Whether display the modern icons for modals.
(setq doom-modeline-modal-modern-icon t)

;; When non-nil, always show the register name when recording an evil macro.
(setq doom-modeline-always-show-macro-register nil)

;; Whether display the gnus notifications.
(setq doom-modeline-gnus t)

;; Whether gnus should automatically be updated and how often (set to 0 or smaller than 0 to disable)
(setq doom-modeline-gnus-timer 2)

;; Wheter groups should be excludede when gnus automatically being updated.
(setq doom-modeline-gnus-excluded-groups '("dummy.group"))

;; Whether display the IRC notifications. It requires `circe' or `erc' package.
(setq doom-modeline-irc t)

;; Function to stylize the irc buffer names.
(setq doom-modeline-irc-stylize 'identity)

;; Whether display the battery status. It respects `display-battery-mode'.
(setq doom-modeline-battery t)

;; Whether display the time. It respects `display-time-mode'.
(setq doom-modeline-time t)

;; Whether display the misc segment on all mode lines.
;; If nil, display only if the mode line is active.
(setq doom-modeline-display-misc-in-all-mode-lines t)

;; The function to handle `buffer-file-name'.
(setq doom-modeline-buffer-file-name-function #'identity)

;; The function to handle `buffer-file-truename'.
(setq doom-modeline-buffer-file-truename-function #'identity)

;; Whether display the environment version.
(setq doom-modeline-env-version t)
;; Or for individual languages
(setq doom-modeline-env-enable-python t)
(setq doom-modeline-env-enable-ruby t)
(setq doom-modeline-env-enable-perl t)
(setq doom-modeline-env-enable-go t)
(setq doom-modeline-env-enable-elixir t)
(setq doom-modeline-env-enable-rust t)

;; Change the executables to use for the language version string
(setq doom-modeline-env-python-executable "python") ; or `python-shell-interpreter'
(setq doom-modeline-env-ruby-executable "ruby")
(setq doom-modeline-env-perl-executable "perl")
(setq doom-modeline-env-go-executable "go")
(setq doom-modeline-env-elixir-executable "iex")
(setq doom-modeline-env-rust-executable "rustc")

;; What to display as the version while a new one is being loaded
(setq doom-modeline-env-load-string "...")

;; By default, almost all segments are displayed only in the active window. To
;; display such segments in all windows, specify e.g.
(setq doom-modeline-always-visible-segments '(irc))

;; Hooks that run before/after the modeline version string is updated
(setq doom-modeline-before-update-env-hook nil)
(setq doom-modeline-after-update-env-hook nil)

(add-to-list 'global-mode-string '("" mode-line-keycast))
#+end_src

* AI
** ChatGPT
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package gptel
  :straight (:host github :repo "karthink/gptel" :files ("dist" "*.el")))

(let ((mixtral (gptel-make-ollama "Ollama"
		 :host "localhost:11434"
		 :stream t
		 :models '("mixtral:instruct"))))
  (if (not im-at-work)
      (set gptel-backend mixtral)
    nil))

(evil-global-set-key 'normal "gsm" 'gptel-menu)
(evil-global-set-key 'normal "gss" 'gptel-send)
(evil-global-set-key 'normal "gso" 'gptel)
(evil-global-set-key 'normal "gsp" 'gptel-system-prompt)
(evil-global-set-key 'normal "gsc" 'gptel--read-crowdsourced-prompt)

(global-set-key (kbd "C-'") #'gptel-send)

#+end_src

* Hunting
#+begin_src emacs-lisp :tangle ~/.emacs
(use-package yara-mode)

(with-eval-after-load 'lsp-mode
  (add-to-list 'lsp-language-id-configuration
	       '(yara-mode . "yara"))

  (lsp-register-client
   (make-lsp-client :new-connection (lsp-stdio-connection "yls")
                    :activation-fn (lsp-activate-on "yara")
                    :server-id 'yls)))
#+end_src

* Finally
Load my RSS feeds
#+begin_src emacs-lisp :tangle ~/.emacs
(if (not im-at-work)
    (load-file "~/.password-store/Config/elfeed.el.gpg"))
#+end_src

* Feeds 

** Youtube

#+begin_src emacs-lisp :tangle ~/.emacs
(setq youtube-feeds
      '(
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC5fdssPqmmGhkhsJi4VcckA" innuendo-studios youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCDsElQQt_gCZ9LgnW-7v-cQ" kirsten-dirksen youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCsXVk37bltHxD1rDPwtNM8Q" kurzgesagt youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCJXa3_WNNmIpewOtCHf3B0g" laurie-wired youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC8gFadPgK2r1ndqLI04Xvvw" maangchi youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCV5vCi3jPJdURZwAOO_FNfQ" thought-emporium youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCe2JAC5FUfbxLCfAvBWmNJA" food-lab youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCWZ3HFiJkxG1K8C4HVnyBvQ" vic-berger youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCWjmAUHmajb1-eo5WKk_22A" audioTree music youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC9-y-6csu5WGm29I7JiwpnA" computerphile youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCSkzHxIcfoEr69MWBdo0ppg" cuck-philosophy youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCo-3ThNQmPmQSQL_L6Lx1_w" deepsky-videos youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC-yuWVUplUJZvieEligKBkA" javidx9 youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCa_8y96THr7LzMg8BsU-sUw" just-wondering youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC3I2GFN_F8WudD_2jUZbojA" KEXP youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCJgBqh3tYway5A5VgV4dZRw" mr-bill youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCoxcjq-8xIDTYp3uz647V5A" numberphile youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC--DwaiMV-jtO-6EvmKOnqg" oa-labs youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCvBqzzvUBLCs8Y7Axb-jZew" sixety-symbols youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCGaVdbSav8xWuFWTadK6loA" vlogbrothers youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCy-AwzC0US6T_DALeiqnLHQ" yan-z youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC4eYXhJI4-7wSWc8UNRwD4A" tiny-desk youtube  music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCvB3solmhqtgDeLpD-yTtfg" hickok45 youtube )
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCdBnxYbzwu5CypEdMfu4_jA" leeya-katrina youtube music )
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCzIlUODCqKo7Og_OIp66x9g" lucy-riddett youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCaB0Vx7zrGJRrOQb42bI99g" milan youtube  music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCtc5INMrIDrDEbv2FLK4bVg" natalie-chami youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCO8yPl56VVCnRM7qnnBIDew" peter-neils youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCdsLnOiepq0GEPpGY14V5Rg" piotr-jagielski youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCchFx5hTGnhjya-odX_6Fpw" rory-hoffman youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCl-WbRCwODSd2BRQSxJcq2g" tenebrae-chior youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC8fqt_PDhDDszL5Zi8EauqA" terminal-passage youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCg6IiNQqZWJH3ZFfJhXRMsg" octavism youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCrfKGpvbEQXcbe68dzXgJuA" forgotten-weapons youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCpbx4wlyihmnsBy9uAE_kdA" stick-in-the-wheel youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCeUNM9NqJqZXfRNeuW4_2sg" inrangetv youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCC6KehJqUUrWLlfPCWh7lTA" moshe-zuchter youtube   music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCnPl-b0Xw-A20ukIQEJ0_Nw" yuri-charyguine youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UClcE-kVhqyiHCcjYwcpfj9w" liveoverflow youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCIA8TCSZ-BaBX-aJv92tpRQ" tim-heidecker youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCCd1Cwjp3hK1tTxevgnHD3g" aline-gingertail youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC-_SoG6x0XvcQRgQEh7Ce9Q" dj-cummerbund youtube  music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCcXhhVwCT6_WqjkEniejRJQ" wintergatan youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCw2Veg8X4aCUitGn9xTMi8A" cassie-accordion youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCltmf0pqjXyLtNsF2vek_wQ" guqin youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCdutJyKPX5uOJxNN0wM4g-A" classic-documentary youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCF3I2RRLRVh_HuXP9sNlhNg" weltmeister youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC-AQKm7HUNMmxjdS371MSwg" channel-5 youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC4eYXhJI4-7wSWc8UNRwD4A" npr-music youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCk0tHQym-zIaxjrVuTzojdg" embahn youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCigygyPkHm07o-wQvkET7Og" george-collier youtubemusic )
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCm9K6rby98W8JigLoZOh6FQ" lock-picking-lawyer youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCposMD82i8gEmpnSG-rrO1g" mojca youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCrCTC5_t-HaVJ025DbYITiw" alice-capelle youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCqM0zDcFNdAHj7uQkprLszg" positron youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCuVLTxl-I0glJYPfcPKJg7w" heymun youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCAzPN3ilUBKEU0hcQ0vuxpw" george-secor youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCHP9CdeguNUI-_nBv_UXBhw" daniel-naroditsky youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCJjFX23mI0oZaZirtIgyE-Q" david-lange youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCzJVGqsvZ3ti197NMIjE5ig" elina-spitsa youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC6EnFbK-P5q0zeaqI5yobKg" benjamin-finegold youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC7shUDSkHjuQNegPhGdANQQ" art-of-listening youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC8TZwtZ17WKFJSmwTZQpBTA" my-analogue-journal youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCWamialv2ZhqR7BPPu0Niug" side-channel-security youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCQB04t2hxSBVTjxpbIHdI-w" sam-aaron youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCwfYU2M8TBAus0TIaNtjxlQ" jam-in-the-van youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCd2KNtfphz8HvYzM4pwtHmg" like-a-version youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCz5RHlX7cGeayKn4FU6u7tA" little-elephant youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCBQ8NG_fqzmAmGEriQW1XZQ" our-vinyl youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCOCjoq4cms20Ik39r1aOqXA" cardinal-sessions youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCfKl318qMJ2p8TUmfL4wdPQ" songs-from-the-shed youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UChsZje1ssMSDgWoxm4VQn_w" wild-honey-pie youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCG36u-k09zdIPQh5EEdVgTA" mahogany-music youtube  Mahogany music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCRLZb8PpI9N7COmYqHiDH7A" sofar-sounds youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC_VZvcOjwfLK0BY79tB-moQ" melodart youtube music)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UC7kIy8fZavEni8Gzl8NLjOQ" alexoconnor youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCDIJ45Bba6nzrGL5v8b7fMw" conneromalley youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCNAxrHudMfdzNi6NxruKPLw" samharris youtube)
	("https://www.youtube.com/feeds/videos.xml?channel_id=UCASM0cgfkJxQ1ICmRilfHLw" patrick-boyle youtube)
	))
#+end_src

** Podcasts
#+begin_src emacs-lisp :tangle ~/.emacs
(setq podcast-feeds
      '(
	("http://feeds.99percentinvisible.org/99percentinvisible" 99pi podcast)
	("https://feeds.buzzsprout.com/244372.rss" crazy-town podcast)
	("http://rss.acast.com/nature" nature podcast)
	("https://feeds.eff.org/howtofixtheinternet" how-to-fix-the-internet podcast)
	("https://feeds.megaphone.fm/search-engine" search-engine podcast)
	("https://feeds.megaphone.fm/TBIEA2761282490" four-oh-four podcast)
	("http://feeds.feedburner.com/birdnote/OYfP" bird-note podcast) 
	("https://www.kcrw.com/culture/shows/nocturne/rss.xml" nocturne podcast)
	("http://feeds.wnyc.org/onthemedia" on-the-media podcast)
	("https://www.npr.org/rss/podcast.php?id=510289" planet-money podcast)
	("http://rss.acast.com/pulseoftheplanet" pulse-of-the-planet podcast) 
	("http://feeds.wnyc.org/radiolab" radiolab  podcast)
	("https://anchor.fm/s/7f22824/podcast/rss" sounds-by-nature podcast)
	("https://www.ecoshock.org/feed/lofi" radio-ecoshock podcast)
	("http://feeds.wpr.org/wpr-politics" wpr-politics podcast)
	("http://feeds.wnyc.org/tnypoetry" new-yorker-poetry podcast) 
	("https://feeds.simplecast.com/p7Q9jZ0K" poem-of-the-day podcast)
	("https://www.npr.org/rss/podcast.php?id=510019" all-songs-considered podcast)
	("https://feeds.megaphone.fm/darknetdiaries" darknet-diaries podcast)
	("https://feeds.simplecast.com/dxZsm5kX" pod-save-america podcast)
	))
#+end_src

** Listen to this
#+begin_src emacs-lisp :tangle ~/.emacs
(setq music-firehose-feeds
      '(
      ("https://www.reddit.com/r/listentothis/.rss" listen-to-this music reddit)
      ))
#+end_src

** Government Firehoses
#+begin_src emacs-lisp
(setq government-feeds
      '(
	("https://www.sec.gov/cgi-bin/browse-edgar?action=getcompany&CIK=0001078075&type=&dateb=&owner=include&start=0&count=40&output=atom" sec gov first sec)
	("https://www.ftc.gov/feeds/press-release.xml" ftc gov first ftc)
	("https://www.ftc.gov/feeds/press-release-competition.xml" gov first ftc)
	("https://www.ftc.gov/feeds/press-release-consumer-protection.xml" gov first ftc)
	("https://api2.fcc.gov/edocs/public/api/v1/rss/" gov first fcc)
	("https://api2.fcc.gov/edocs/public/api/v1/rss/docTypes/Cit" gov first fcc)
	("http://licensing.fcc.gov/myibfs/yesterdaysFilingsFeed.do" gov first fcc)
	("http://licensing.fcc.gov/myibfs/yesterdaysActionsFeed.do" gov first fcc)
	("http://licensing.fcc.gov/myibfs/recentPNFeed.do" gov first fcc)
	("http://efilingapps.fec.gov/rss/generate?preDefinedFilingType=ALL" gov first fec)
	("https://efilingapps.fec.gov/rss/generate?preDefinedFilingType=ALL" gov fec first)
	("https://www.nsa.gov/DesktopModules/ArticleCS/RSS.ashx?ContentType=1&Site=920&max=20" gov first nsa)
	))
#+end_src

** Security Feeds
#+begin_src emacs-lisp :tangle ~/.emacs
(setq security-feeds
      '(
       ("https://www.amnesty.org/en/latest/feed/" amnesty security second)
	("https://media.ccc.de/updates.rdf" ccc security second)
	("https://www.us-cert.gov/ncas/alerts.xml" us-cert-alerts security second)
	("https://www.cisa.gov/cybersecurity-advisories/all.xml" us-certs-all security second)
	("https://securelist.com/feed/" securelist security second)
	("http://blog.dynamoo.com/feeds/posts/default" dynamoo security second)
	("http://feeds.feedburner.com/feedburner/Talos?format=xml" cisco-talos security second)
	("https://newsroom.trendmicro.com/news-releases?pagetemplate=rss&category=787" trend-micro security second)
	("https://feeds.feedburner.com/PaloAltoNetworks" unit42 security second)
	("https://www.proofpoint.com/rss.xml" proofpoint security second)
	("http://asert.arbornetworks.com/feed/" arbor-networks security second)
	("http://addxorrol.blogspot.com/feeds/posts/default" addxorrol security second)
	("http://herrcore.blogspot.com/feeds/posts/default" herrcore security second)
	("https://threatlabz.zscaler.com/blogs" zscalar security second)
	("http://googleonlinesecurity.blogspot.com/atom.xml" google-security security second)
	("http://bartblaze.blogspot.com/feeds/posts/default" bartblaze security second)
	("https://www.exploit-db.com/rss.xml" exploit-db security second) 
	("https://bittherapy.net/post/index.xml" bittherapy security second)
	("http://malwaredomains.com/?feed=rss2" malware-domains security second)
	("http://windowsir.blogspot.com/feeds/posts/default" windows-incident-response security second)
	("http://www.schneier.com/blog/index.rdf" schneier-on-security security second)
	("http://contagiodump.blogspot.com/feeds/posts/default" contagio security second)
	("http://feeds.feedburner.com/darknethackers" darknet-hackers security second)
	("http://securityaffairs.co/wordpress/feed" security-affairs security second)
	("http://blog.invisiblethings.org/feed.xml" invisible-things security second)
	("https://threatpost.com/feed" threatpost security second)
	("http://hackingexposedcomputerforensicsblog.blogspot.com/feeds/posts/default" hacking-exposed security second)
	("http://detect-respond.blogspot.com/feeds/posts/default" detect-respond security second)
	("https://feeds.feedburner.com/threatintelligence/pvexyqv7v0v" fireeye security second)
	("http://www.elsevierscitech.com/feeds/feeds/b2b/14.xml" elsevierscitech security second)
	("https://malware.dontneedcoffee.com/feed.xml" dont-need-coffee security second)
	("https://www.darktrace.com/blog/index.xml" darktrace security second)
	("http://krebsonsecurity.com/feed/" krebs-on-security security second)
	("http://www.swiftforensics.com/feeds/posts/default" swift-forensics security second)
	("http://www.darkreading.com/rss.xml" dark-reading security second)
	("http://taosecurity.blogspot.com/atom.xml" tao-security security second)
	("https://isc.sans.edu/rssfeed_full.xml" sans security second)
	("http://blog.malwarebytes.org/feed/" malware-bytes security second)
	("https://www.wired.com/feed/category/security/latest/rss" wired security second)
	("http://ryanstillions.blogspot.com/feeds/posts/default" ryan-stillions security second)
	("http://www.theregister.co.uk/security/headlines.atom" register security second)
	("https://www.recordedfuture.com/feed/" recorded-future security second)
	("http://www.malware-traffic-analysis.net/blog-entries.rss" malware-traffic-analysis security second)
	("https://www.bellingcat.com/feed/" bellingcat security second)
	("https://www.clearskysec.com/feed/" clearsky-sec security second)
	("https://thecomputerperson.wordpress.com/rss" the-computer-person security second)
	("https://dfir.it/atom.xml" dfir-it re)
	("https://www.msreverseengineering.com/blog?format=rss" ms-reverse-engineering security second re)
	("https://www.wired.com/feed/category/security/latest/rss" wired-security tech)
	("https://www.sentinelone.com/blog/rss" sentinel-one tech security)
	("https://labs.f-secure.com/blog/rss" f-secure tech security)
	("https://euvsdisinfo.eu/articles/feed" eu-disinfo security)
	("https://www.megabeets.net/rss" megabeets tech)
	("https://pluralistic.net/feed/" pluralistic tech)
	("https://seclists.org/rss/fulldisclosure.rss" second seclists tech security)
	("https://www.404media.co/rss" 404media tech security)
	("https://feeds.feedburner.com/TheHackersNews" second thehackernews tech security)
	))
#+end_src

** Mobile Feeds
#+begin_src emacs-lisp :tangle ~/.emacs
(setq mobile-feeds
      '(
        ("https://www.nowsecure.com/blog/category/research-threat-intel/rss" nowsecure mobile)
        ("https://citizenlab.org/feed/" citizenlab mobile)
        ("https://blog.lookout.com/topics#/researchers/" lookout mobile)
        ("https://blog.zimperium.com/feed/" zimperium mobile)
        ("https://blog.pulsesecure.net/feed/" pulse-secure mobile)
        ("http://www.f-secure.com/weblog/weblog.rss" f-secure mobile)
        ("https://blog.google/threat-analysis-group/rss/" google-tao mobile)
	))
#+end_src

** Comics
#+begin_src emacs-lisp :tangle ~/.emacs
(setq comic-feeds '(
		    ("http://pbfcomics.com/feed/feed.xml" pbfcomics second)
		    ("http://existentialcomics.com/rss.xml" existential-comics comics)
		    ("http://xkcd.com/rss.xml" xkcd comics)
		    ))
#+end_src
** Art Feeds
#+begin_src emacs-lisp :tangle ~/.emacs
(setq art-feeds
      '(
	("https://doorofperception.com/rss" door-of-perception art)
	))
#+end_src
** Culture Feeds
#+begin_src emacs-lisp :tangle ~/.emacs
(setq culture-feeds
      '(
	("https://thebaffler.com/latest/feed" the-baffler lefty news)
	("https://www.resilience.org/feed/" resillience lefty news)
	("https://www.newyorker.com/feed/everything" new-yorker lefty)
	("https://defector.com/feed/" defector lefty)
	("http://jacobinmag.com/feed" jacobin lefty)
	("https://journalofcontroversialideas.org/rss" controvertial-ideas lefty)
	("https://www.documentjournal.com/category/above-the-fold/rss" document-journal lefty)
	))
#+end_src

** Live Feeds
#+begin_src emacs-lisp :tangle ~/.emacs
(setq news-live-feeds
      '(
	("http://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml" news first)
	("http://feeds.propublica.org/propublica/main" first)
	))
#+end_src

** Local Feeds
#+begin_src emacs-lisp :tangle ~/.emacs
(setq local-feeds
      '(
	("https://gopresstimes.com/de-pere" go-press-times local)
	("http://host.madison.com/search/?f=rss&t=article&c=news/state_and_regional&q=%23wsj&l=25&s=start_time&sd=desc" madison-news local)
	))
#+end_src

** Tech Feeds
#+begin_src emacs-lisp :tangle ~/.emacs
(setq tech-feeds
      '(
	("https://100r.co/links/rss.xml" 100rabbits blog tech)
	("https://nomasters.io/index.xml" nomasters blog tech)
	("https://blog.codinghorror.com/rss/" coding-horror tech)
	("https://www.rtl-sdr.com/feed/" rtl-sdr tech)
	("https://nullprogram.com/feed/" null-program tech blog emacs)
	("https://www.theverge.com/policy/rss/index.xml" the-verge tech)
	("https://wrongbaud.github.io/feed.xml" wrong-baud second tech)
	("https://usesthis.com/feed.atom" uses-this tech)
	("https://irreal.org/blog/?feed=rss2" irreal emacs)
	("https://feeds.sachachua.com/sachac" sachachua emacs)
	("https://ciechanow.ski/atom.xml" ciechanow tech)
	("https://cdn.jwz.org/blog/feed/" jwz tech)
	("https://lwn.net/headlines/rss" lwn tech)
	("https://blog.onloop.net/rss" onloop tech)
	("https://blog.oimo.io/rss" oimo tech)
	("https://johnnydecimal.com/rss.xml" johnnydecimal tech)
	("https://hnrss.org/frontpage" hackernews tech)
	("https://fossacademic.tech/feed.xml" fossacademic tech)
	("https://www.stallman.org/rss/rss.xml" stallman emacs tech gnu)
	))
#+end_src


** Combine
#+begin_src emacs-lisp :tangle ~/.emacs
(setq elfeed-feeds (append art-feeds
			   comic-feeds
			   ;; government-feeds
			   culture-feeds
			   local-feeds
			   mobile-feeds
			   music-firehose-feeds
			   news-live-feeds
			   podcast-feeds
			   security-feeds
			   tech-feeds
			   youtube-feeds))
#+end_src

** Helper
#+begin_src emacs-lisp :tangle ~/.emacs
(defun feed-to-rss2email-feed (feed)
  (with-temp-buffer (mapcar (lambda (x) (insert (format "[feed.%s]\nurl = %s\n\n"
							(nth 1 x)
							(nth 0 x)))) feed)
		    (kill-region (point-min) (point-max)))
  )
#+end_src

* Work Config
#+begin_src emacs-lisp :tangle ~/.emacs
(if im-at-work
    (progn
      (org-babel-lob-ingest "~/org/config.org")
      (org-sbe work-config)))
#+end_src
